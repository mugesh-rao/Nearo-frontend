import{r as n,_ as R,K as P,h as T,i as B,k as M,j as e,e as E,v as H,w as K,b as W,D as F,y as z,T as N,p as A,C as G}from"./index-70997a97.js";import{O as J,A as U,a as X,d as Z,b as v}from"./OrderSkeleton-269513a0.js";import{I as ee}from"./index.es-9acb4e93.js";import{P as se,B as te}from"./Bill-652105e9.js";import{L as re}from"./LazyLoadImage-edf60663.js";import"./Skeleton-1722e138.js";const ie=n.lazy(()=>R(()=>import("./index-70997a97.js").then(d=>d.bC),["assets/index-70997a97.js","assets/index-52a015f8.css"])),Q=({length:d,shipment_id:f,setOpen:I})=>{const[x,g]=n.useState(new Array(d).fill(""));Q.propTypes={length:P.number.isRequired,shipment_id:P.string.isRequired};const l=n.useRef([]),w=T(),S=(t,o)=>{const c=t.target.value.replace(/\D/g,"");let u=c;o===d-1&&(u=c.slice(0,1)),g(r=>{const b=[...r];return b[o]=u,b}),c===""&&o>0?l.current[o-1].focus():o<d-1&&c!==""&&l.current[o+1].focus()},y=B(),D=t=>E({url:"/orders/mark_shipment_delivered",method:"post",data:t}),[m,h]=n.useState(null),{mutate:k,isLoading:L}=M(D,{onSuccess:t=>{console.log(t==null?void 0:t.data),h(t==null?void 0:t.data),y.invalidateQueries("order_delivered")},onError:t=>{console.log(t)},retry:{maxAttempts:3,delay:t=>t*1e3}}),C=async t=>{t.preventDefault();const o=new FormData;o.append("session_id",w),o.append("order_shipment_slip_id",f),o.append("delivery_otp",x.join("")),await k(o)};return e.jsx(e.Fragment,{children:L?e.jsx("div",{className:"",children:e.jsx(ie,{})}):e.jsxs("form",{action:"",onSubmit:C,children:[e.jsx("div",{className:"flex justify-center space-x-2",children:x==null?void 0:x.map((t,o)=>e.jsx("input",{type:"tel",inputMode:"numeric",pattern:"[0-9]*",className:"w-12 h-12 text-4xl border border-cyan-300 text-cyan-700 text-center focus:outline-none focus:ring-2 focus:ring-cyan-500",value:t,onChange:c=>S(c,o),required:!0,ref:c=>l.current[o]=c},o))}),(m==null?void 0:m.success)==0&&e.jsxs("p",{className:"my-2 text-center text-red-600 text-sm ",children:[" ",m==null?void 0:m.message]}),e.jsx("button",{className:"mt-3 text-white btn1 p-2 c500:font-semibold mx-auto w-full duration-500",type:"submit",children:"Continue"}),e.jsxs("p",{className:"text-center my-3 mx-4  text-sm",children:["if you don","'","t know check  ",e.jsx("span",{className:"text-black font-semibold",children:"My Order"})," ",e.jsx("br",{}),"we had already sent it"]})]})})},q=n.lazy(()=>R(()=>import("./index-70997a97.js").then(d=>d.bC),["assets/index-70997a97.js","assets/index-52a015f8.css"])),me=()=>{const{activeLinkParam:d}=H(),f=K(),I=W(),[x,g]=n.useState(d),l=T();n.useEffect(()=>{g(d)},[d]),n.useEffect(()=>{g(f.pathname)},[f]);const[w,S]=n.useState(!0),[y,D]=n.useState(0),[m,h]=n.useState(!1),[k,L]=n.useState(""),C=s=>E({url:"/orders/get_order_shipments",method:"post",data:s}),t=B(),o=s=>E({url:"orders/download_bill",method:"post",data:s}),{mutate:c,isLoading:u}=M(C,{onSuccess:s=>{console.log(s==null?void 0:s.data.data);const _=new Set(r.map(i=>i.order_id)),j=s==null?void 0:s.data.data.filter(i=>!_.has(i.order_id));b(i=>{const a=new Set(j.map(p=>p.order_id));return[...i.filter(p=>!a.has(p.order_id)),...j]}),(r==null?void 0:r.length)===0&&S(!1),t.invalidateQueries("low_stocks_data")},onError:s=>{console.log(s)},retry:{maxAttempts:3,delay:s=>s*1e3}}),[r,b]=n.useState(n.useMemo(()=>{const s=t.getQueryData("session_id");return s?s.data:[]},[t]));n.useEffect(()=>{if(!l)I("/login");else{const s=new FormData;s.append("session_id",l),s.append("page",y),s.append("shipment_status",1),c(s)}},[l]);const V=()=>{D(_=>_+1);const s=new FormData;s.append("session_id",l),s.append("page",y),s.append("shipment_status",1),c(s)},[Y,$]=n.useState(n.useMemo(()=>{const s=t.getQueryData("session_id");return s?s.data:null},[t]));return(!r||r.length==0)&&!u?e.jsxs(e.Fragment,{children:[x=="/dashboard/shipping"?e.jsx(F,{}):"",e.jsx("h2",{className:"h-[450px] text-xl text-center custom400:text-2xl sm:text-3xl text-gray-700 grid place-items-center w-full px-3",children:"No order to pack"})]}):e.jsxs(e.Fragment,{children:[x=="/dashboard/shipping"?e.jsx(F,{}):"",e.jsxs("div",{className:"bg-white sm:shadow-[0_3px_10px_rgb(0,0,0,0.2)] sm:mx-2 rounded-lg py-2",children:[e.jsxs("div",{className:"hidden  sm:flex text-2xl font-semibold lg:text-3xl m-6 ",children:[e.jsx("h1",{children:" Ready For Ship  "}),r&&e.jsx("div",{className:"h-[40px] w-[50px] bg-[#e9f2f7] mx-2 rounded-lg grid place-items-center",children:e.jsx("span",{className:"  text-[#13b8f8] text-[1.5rem]  ",children:(r==null?void 0:r.length)<10&&(r==null?void 0:r.length)>0?`0${r==null?void 0:r.length}`:r==null?void 0:r.length})})]}),e.jsx("div",{className:"  overflow-y-scroll h-[500px] my-8 ",id:"target_this",children:e.jsx(ee,{dataLength:(r==null?void 0:r.length)||0,next:V,hasMore:w,loader:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(q,{})," ",e.jsx("p",{className:"text-xl text-red-400",children:"inventory"})," "]}),endMessage:e.jsx("p",{style:{textAlign:"center"},children:e.jsx("b",{children:"Yay! You have seen it all"})}),scrollableTarget:"target_this",children:u?e.jsx(J,{data:[1],data2:[1,2,3,4,5]}):e.jsxs("div",{children:[" ",r.map((s,_)=>{var j;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:" my-6 px-2 custom400:px-4 ",children:[e.jsxs("div",{className:" flex justify-between ",children:[e.jsxs("p",{className:"flex",children:[e.jsxs("b",{children:[" ",_+1,"."]}),"   ",e.jsxs("div",{className:"text-[#5a5a0a] sm:text-[#1687a7] ",children:[s.order_id&&e.jsxs("h4",{className:"sm:text-lg",children:["Order ID: ",s.order_id]}),s.order_time&&e.jsxs("span",{className:"hidden sm:block",children:["Order Date:"," ",z(s.order_time).toLocaleString()]})]})]}),e.jsxs("div",{className:"hidden sm:flex flex-col items-end",children:[s.order_shipment_slip_id&&e.jsxs("p",{className:"text-[#1687a7]",children:["Shipment Id: ",s==null?void 0:s.order_shipment_slip_id]}),(s==null?void 0:s.order_delivery_type)&&e.jsxs("p",{className:"text-green-500",children:["Order Type:"," ",(s==null?void 0:s.order_delivery_type)==1?"Store Pickup":"Delivery"]})]})]},s.order_id),e.jsx("br",{}),(j=s==null?void 0:s.product_details)==null?void 0:j.map(i=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex sm:items-center sm:justify-between flex-col sm:flex-row my-4 ",children:[e.jsxs("div",{className:"flex sm:w-[60%]",children:[e.jsx(re,{src:i==null?void 0:i.main_image,alt:i==null?void 0:i.main_image,className:"w-[80px] h-[100px] object-contain aspect-[3/2] "}),e.jsxs("div",{className:"ml-2",children:[i.product_title&&e.jsx("h4",{className:"text-wrap w-full my-2 text-sm c500:text-[1rem]",children:i.product_title}),i.total_price_with_tax&&e.jsxs("h4",{className:"font-semibold text-2xl",children:["₹ ",i.total_price_with_tax]})]})]}),e.jsx("div",{className:"hidden sm:block font-semibold text-lg capitalize ",children:i.total_price_with_tax&&e.jsxs("h4",{className:"font-semibold text-2xl",children:["₹ ",i.total_price_with_tax]})}),e.jsx("div",{className:"hidden sm:block font-semibold text-lg sm:mr-10",children:(s==null?void 0:s.total_product_quantity)&&e.jsxs("p",{children:[s==null?void 0:s.total_product_quantity," "]})}),e.jsxs("div",{className:"text-[#73B7CA] flex space-x-4 justify-between my-4 text-sm sm:hidden ",children:[s.colour&&e.jsxs("div",{children:["Color :",e.jsx("b",{className:"text-[#1687a7] capitalize ",children:s.colour})]}),s.size&&e.jsxs("div",{children:["Size:"," ",e.jsx("b",{className:"text-[#1687a7] uppercase",children:s.size})]}),s.total_product_quantity&&e.jsxs("div",{children:["Qty. :"," ",e.jsx("b",{className:"text-[#1687a7] ",children:s.total_product_quantity})]})]})]},i.order_id)})),e.jsxs("div",{className:"flex flex-col sm:flex-row  sm:items-center sm:justify-end sm:space-x-4 space-x-0 sm:space-y-0 space-y-4 ",children:[e.jsx("div",{className:"sm:hidden",children:e.jsxs(U,{sx:{background:"#D0E7ED",borderRadius:"20px"},children:[e.jsx(X,{expandIcon:e.jsx(Z,{}),"aria-controls":"panel1a-content",id:"panel1a-header",children:e.jsx(N,{sx:{color:"#1687a7"},children:"Order Details"})}),e.jsx(v,{children:e.jsxs(N,{className:"text-[#5a5a0a]",style:{fontSize:"14px"},children:[s.order_time&&e.jsxs("span",{children:["Order Date :"," ",z(s.order_time).toLocaleDateString()]}),e.jsx("br",{}),s.order_shipment_slip_id&&e.jsxs("p",{children:["Shipment Id: ",s==null?void 0:s.order_shipment_slip_id]}),s.payment_type&&e.jsxs("span",{children:["Order Type:"," ",(s==null?void 0:s.order_delivery_type)==1?"Store Pickup":"Delivery"]})]})})]})}),e.jsx(A.Button,{className:"bg-green-600 text-[14px] p-3 px-8 ",onClick:()=>[h(!0),L(s==null?void 0:s.order_shipment_slip_id)],children:"Enter Code"}),e.jsx(se,{document:e.jsx(te,{bill_datas:Y}),fileName:"Invoice",onClick:()=>{const i=new FormData;i.append("session_id",l),i.append("order_shipment_slip_id",s==null?void 0:s.order_shipment_slip_id),console.log("shipment",s==null?void 0:s.order_shipment_slip_id),o(i).then(a=>{var O,p;(O=a==null?void 0:a.data)!=null&&O.success&&$((p=a==null?void 0:a.data)==null?void 0:p.data),t.invalidateQueries("order_delivered")}).catch(a=>{console.log(a)})},children:({loading:i})=>e.jsx(A.Button,{className:"bg-[#1687a7] capitalize flex items-center justify-center text-[14px] p-3 px-8 w-full",children:i?"Loading...":"Download Bill"})}),e.jsx(G,{open:m,onNo:()=>h(!1),size:"medium",title:"Enter Code",className:"w-auto c500:w-[400px] mx-auto h-[550px]",children:e.jsxs("div",{className:"h-[250px] ",children:[e.jsx(N,{id:"modal-modal-title",variant:"h6",component:"h2",children:e.jsx("div",{className:" custom400:p-4 max-w-max mx-auto my-2 mt-4",children:e.jsx(n.Suspense,{fallback:e.jsx("div",{className:"h-screen grid place-items-center absolute bg-white z-20 top-0 right-0 bottom-0 left-0",children:e.jsx(q,{})}),children:e.jsx(Q,{length:4,autoFocus:!0,secure:!0,shipment_id:k,setOpen:h})})})}),e.jsx(N,{id:"modal-modal-description",sx:{mt:2}})]})})]}),e.jsx("br",{}),e.jsx("hr",{}),e.jsx("br",{})]})})})]})})})]})]})};export{me as default};
