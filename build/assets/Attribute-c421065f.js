import{r as n,i as se,h as re,k as g,j as r,a3 as ae,A as ne,f as oe,p as i,s as I,e as j}from"./index-70997a97.js";const ue=({onSelect:_,category_last_id:y,attributesID:w,setAttributeID:N,data:d,productId:D})=>{const[l,u]=n.useState([]),[v,p]=n.useState([]),[m,C]=n.useState(""),[h,b]=n.useState([]),[L,F]=n.useState([]),[S,z]=n.useState([]),[M,R]=n.useState(!0),O=n.useRef([]),f=se(),Q=re(),T=n.useCallback((e,t)=>{F(s=>{const a=[...s];return a[t]=!1,a}),b(s=>{const a=[...s];return a[t]=e.target.value,a})},[]),P=n.useCallback(e=>{b(t=>{const s=[...t];return s[e]="",s}),u(t=>{const s=[...t];return s[e]=!1,s})},[]),q=n.useCallback(e=>{u(t=>{const s=[...t];return s[e]=!1,s}),p(t=>{const s=[...t];return s[e]=h[e],s}),b(t=>{const s=[...t];return s[e]="",s})},[h]);n.useEffect(()=>{const e=(s,a)=>{O.current[a]&&!O.current[a].contains(s.target)&&u(c=>{const o=[...c];return o[a]=!1,o})},t=s=>{for(let a=0;a<l.length;a++)e(s,a)};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[l]);const V=n.useCallback((e,t,s,a)=>{p(c=>{const o=[...c];return o[t]=e,o}),_(e),N([...w,[+s,+a]]),C(""),u(c=>{const o=[...c];return o[t]=!1,o})},[_,w,N]),B=n.useCallback(e=>{C(e.target.value)},[]),H=e=>j({url:"/datas/get_product_category_attributes",method:"post",data:e}),{mutate:Y,isProductAttributeLoading:ce}=g(H,{onSuccess:e=>{var t;e.status&&(console.log(e),z((t=e==null?void 0:e.data)==null?void 0:t.product_attributes_data)),f.invalidateQueries("category_4_id")},onError:e=>{console.log(e)},retry:{maxAttempts:3,delay:e=>e*1e3}}),$=e=>j({url:"/products/remove_attributes_from_product",method:"post",data:e}),{mutate:G,isAttributeDeleting:J}=g($,{onSuccess:e=>{var t,s,a;(t=e==null?void 0:e.data)!=null&&t.success?I.success((s=e==null?void 0:e.data)==null?void 0:s.message):I.error((a=e==null?void 0:e.data)==null?void 0:a.message),f.invalidateQueries("category_4_id")},onError:e=>{console.log(e)},retry:{maxAttempts:3,delay:e=>e*1e3}}),K=e=>{const t=new FormData;t.append("session_id",Q),t.append("product_id",D),t.append("product_attribute_id",e),G(t)};function U(e,t,s){console.log(e,t);const a=new Set(t.map(o=>o[s]));return e.filter(o=>!a.has(o[s]))}const[A,W]=n.useState([]);n.useEffect(()=>{const e=new FormData;e.append("category_4_id",y),Y(e),R(!1),W(U(S,d,"product_attribute_id"))},[y]),console.log(A);const X=e=>j({url:"/datas/get_product_attribute_values",method:"post",data:e}),{mutate:k,isLoading:Z}=g(X,{onSuccess:e=>{var t;ee((t=e==null?void 0:e.data)==null?void 0:t.data),f.invalidateQueries("product_attribute_id")},onError:e=>{console.log(e)},retry:{maxAttempts:3,delay:e=>e*1e3}}),E=n.useCallback((e,t)=>{const s=new FormData;s.append("product_attribute_id",t),(async()=>{try{await k(s)}catch(c){console.log(c)}})(),u(c=>{const o=[...c];return o[e]=!o[e],o}),p(c=>{const o=[...c];return o[e]="",o})},[k]),[x,ee]=n.useState([]),te=n.useMemo(()=>x&&x.filter(e=>e.title.toLowerCase().includes(m.toLowerCase())),[x,m]);return M||Z||J?r.jsx("h2",{className:"text-5xl text-red-500 h-screen flex justify-center  items-center",children:"loading"}):r.jsxs("div",{className:"grid grid-cols-1 w-full gap-10 items-center c500:grid-cols-2",children:[d&&d.map((e,t)=>r.jsx(n.Fragment,{children:r.jsxs("label",{htmlFor:"Fabric",className:"w-full ",children:[r.jsxs("p",{children:[e.name," ",r.jsx("span",{className:"text-red-500 text-xl"})]}),r.jsxs("div",{className:"relative",children:[r.jsxs("div",{className:"flex justify-center items-center",children:[r.jsxs("div",{className:"w-full my-2 p-2 py-[10px] text-sm border border-gray-300 hover:border-black rounded-sm placeholder:text-gray-400 flex justify-between items-center",onClick:()=>E(t,+e.product_attribute_id),children:[r.jsx("div",{className:"capitalize",children:v[t]?v[t]:e.value}),r.jsx(ae,{className:`${l[t]?"rotate-180":""}`})]}),r.jsx("div",{onClick:()=>K(e.product_attribute_id),className:"cursor-pointer ml-4",children:r.jsx(ne,{})})]}),l[t]&&r.jsx("div",{className:"fixed bottom-0 top-0 right-0 left-0 ",onClick:()=>E(t)}),l[t]&&r.jsxs("div",{className:"absolute mt-1 w-full z-10 bg-white border border-gray-300 rounded-md shadow-sm  h-[300px] overflow-y-auto whitespace-nowrap",children:[r.jsxs("div",{className:"w-full sticky top-0 z-10 flex items-center px-2 border-b border-gray-300 bg-white",children:[r.jsx(oe,{className:"text-xl text-cyan-600"}),r.jsx("input",{type:"text",className:"w-full p-2 focus:outline-none ",placeholder:"Search...",value:m,onChange:B})]}),r.jsx("ul",{children:te.map(s=>r.jsx("li",{className:"p-2 hover:bg-gray-100 cursor-pointer",onClick:()=>V(s.title,t,e.id,s.id),children:s.title},s.id))}),r.jsxs(i.Menu,{dismiss:{itemPress:L[t]},children:[r.jsx(i.MenuHandler,{children:r.jsx("p",{className:"p-2 sticky bottom-0 bg-white cursor-pointer",children:"Other"})}),r.jsxs(i.MenuList,{className:"z-20 w-[270px]",children:[r.jsxs("h1",{className:"mx-2 text-lg my-2 hover:outline-none",children:["Add Your ",e.title," Name"]}),r.jsx(i.Input,{placeholder:"Fabric Name",onChange:s=>T(s,t),value:h[t],containerProps:{className:"mb-4 focus:outline-none"},className:"focus:outline-none input-border capitalize"}),r.jsxs("div",{className:"flex justify-between mt-10 hover:outline-none",children:[" ",r.jsx("button",{className:"btn2 pt-1 pb-[5px] text-sm",onClick:()=>P(t),children:"Clear"})," ",r.jsx("button",{className:"btn1 pt-1 pb-[7px] text-sm",onClick:()=>q(t),children:"Apply"})," "]})]})]})]})]})]})},e.id)),S.length>0&&r.jsx("select",{children:A.map((e,t)=>r.jsx("option",{children:e==null?void 0:e.title}))})]})};export{ue as default};
